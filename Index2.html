<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>5-manna Speltid Tracker</title>
<style>
body { font-family: Arial, sans-serif; padding: 10px; max-width: 900px; margin: auto; }
h1, h2 { text-align: center; }
input, select, button { margin: 5px 0; padding: 5px; width: 100%; }
.player-input { display: flex; gap: 10px; margin-bottom: 5px; flex-wrap: wrap; }
.player { width: 60px; height: 60px; border-radius: 50%; background: #ffcc00; display: flex; justify-content: center; align-items: center; font-weight: bold; position: absolute; text-align: center; cursor: grab; }
.gk { background: #ff6666; }
.halffield { width: 100%; height: 300px; background: #cce6ff; border: 2px solid #0077cc; margin: 20px 0; position: relative; }
.staplar { display: flex; gap: 5px; flex-wrap: wrap; margin-top: 10px; }
.stapel { width: 60px; background: #00cc66; text-align: center; color: white; font-size: 12px; }
.arrow { font-weight: bold; font-size: 18px; }
.green { color: green; }
.red { color: red; }
#schedule, #summary { margin-top: 10px; }
.summary-table { border-collapse: collapse; width: 100%; margin-top: 10px; }
.summary-table th, .summary-table td { border: 1px solid #ccc; padding: 5px; text-align: center; }
</style>
</head>
<body>

<h1>5-manna Speltid Tracker</h1>

<h2>1. Ange spelare</h2>
<div id="playerInputs"></div>
<button onclick="createPlayerInputs()">Uppdatera spelarnamn</button>

<h2>2. Inställningar</h2>
<label>Antal perioder:</label>
<input type="number" id="periods" value="3" min="1">
<label>Periodlängd (minuter):</label>
<input type="number" id="periodLength" value="10" min="1">

<h2>3. Målvakt per period</h2>
<div id="gkSelects"></div>

<h2>4. Startuppställning (halvplan)</h2>
<div class="halffield" id="halffield"></div>

<h2>5. Matchkontroll</h2>
<button onclick="startMatch()">Starta match</button>
<button onclick="pauseMatch()">Pausa match</button>

<h2>6. Byten / Skador</h2>
<div>
  <label>Välj spelare som går ut:</label>
  <select id="subOut" multiple></select>
  <label>Välj spelare som går in:</label>
  <select id="subIn" multiple></select>
  <button onclick="doSub()">Byt spelare</button>
  <button onclick="markInjury()">Markera skada</button>
</div>

<h2>7. Speltid & schema</h2>
<div id="schedule"></div>
<div id="summary"></div>

<script>
let numPlayers = 8;
let playerInputs = [];
let players = [];
let playerData = [];
let periods = 3;
let periodLength = 10;
let matchRunning = false;
let timer;
let currentMinute = 0;

function createPlayerInputs() {
  const container = document.getElementById("playerInputs");
  container.innerHTML = '';
  playerInputs = [];
  for (let i = 0; i < numPlayers; i++) {
    let div = document.createElement("div");
    div.className = "player-input";
    let inp = document.createElement("input");
    inp.placeholder = `Spelare ${i+1}`;
    inp.id = `player${i}`;
    div.appendChild(inp);
    container.appendChild(div);
    playerInputs.push(inp);
  }
  updateGKSelects();
  updateSubSelects();
}

function updateGKSelects() {
  const gkContainer = document.getElementById("gkSelects");
  gkContainer.innerHTML = '';
  periods = parseInt(document.getElementById("periods").value);
  for (let p = 0; p < periods; p++) {
    let sel = document.createElement("select");
    sel.id = `gk${p}`;
    playerInputs.forEach((input, idx)=>{
      let opt = document.createElement("option");
      opt.value = idx;
      opt.text = input.value || input.placeholder;
      sel.appendChild(opt);
    });
    gkContainer.appendChild(document.createTextNode(`Period ${p+1}: `));
    gkContainer.appendChild(sel);
    gkContainer.appendChild(document.createElement("br"));
  }
}

function updateSubSelects() {
  const outSel = document.getElementById("subOut");
  const inSel = document.getElementById("subIn");
  outSel.innerHTML = ''; inSel.innerHTML = '';
  playerInputs.forEach((inp, idx)=>{
    let name = inp.value || inp.placeholder;
    let opt1 = document.createElement("option"); opt1.value=idx; opt1.text=name; outSel.appendChild(opt1);
    let opt2 = document.createElement("option"); opt2.value=idx; opt2.text=name; inSel.appendChild(opt2);
  });
}

function drawHalffield() {
  const field = document.getElementById("halffield");
  field.innerHTML = '';
  const positions = [
    {x:'45%', y:'80%'}, // GK
    {x:'20%', y:'60%'}, // Back 1
    {x:'70%', y:'60%'}, // Back 2
    {x:'30%', y:'30%'}, // Forward 1
    {x:'60%', y:'30%'}  // Forward 2
  ];
  let onField = playerData.filter(p=>p.onField);
  onField.forEach((p,i)=>{
    let div = document.createElement("div");
    div.className = 'player' + (p.gk?' gk':'');
    div.style.left = positions[i].x;
    div.style.top = positions[i].y;
    div.innerText = p.name;
    field.appendChild(div);
  });
}

function startMatch() {
  players = playerInputs.map(inp=>inp.value || inp.placeholder);
  playerData = players.map(name=>({name, totalPlay:0, gk:false, onField:false, injured:false}));
  periodLength = parseInt(document.getElementById("periodLength").value);
  periods = parseInt(document.getElementById("periods").value);
  currentMinute = 0;

  // Sätt startuppställning: första GK + 4 utespelare
  const gkIdx = parseInt(document.getElementById(`gk0`).value);
  playerData[gkIdx].onField = true; playerData[gkIdx].gk=true;
  let utespelareIdx = [...Array(players.length).keys()].filter(i=>i!==gkIdx);
  for(let i=0;i<4;i++) playerData[utespelareIdx[i]].onField = true;

  drawHalffield();
  updateSummary();

  if(!matchRunning) {
    matchRunning = true;
    timer = setInterval(tickMinute, 1000);
  }
}

function pauseMatch() {
  matchRunning = false;
  clearInterval(timer);
}

function tickMinute() {
  currentMinute++;
  playerData.forEach(p=>{
    if(p.onField && !p.gk && !p.injured) p.totalPlay++;
  });
  updateSummary();
}

function doSub() {
  const outSel = document.getElementById("subOut");
  const inSel = document.getElementById("subIn");
  let outIdx = Array.from(outSel.selectedOptions).map(o=>parseInt(o.value));
  let inIdx = Array.from(inSel.selectedOptions).map(o=>parseInt(o.value));

  // Kontrollera att spelare på planen byts ut
  outIdx.forEach(i=>{playerData[i].onField=false;});
  inIdx.forEach(i=>{playerData[i].onField=true;});

  drawHalffield();
  updateSummary();
}

function markInjury() {
  const outSel = document.getElementById("subOut");
  let injuredIdx = Array.from(outSel.selectedOptions).map(o=>parseInt(o.value));
  injuredIdx.forEach(i=>{
    playerData[i].injured=true;
    playerData[i].onField=false;
  });
  drawHalffield();
  updateSummary();
}

function updateSummary() {
  const sumDiv = document.getElementById("summary");
  let table = '<table class="summary-table"><tr><th>Spelare</th><th>Utespelartid (min)</th><th>Målvakt</th></tr>';
  playerData.forEach(p=>{
    table+=`<tr><td>${p.name}</td><td>${p.totalPlay}</td><td>${p.gk?periodLength*p.gk:false}</td></tr>`;
  });
  table+='</table>';
  sumDiv.innerHTML=table;
}

createPlayerInputs();
updateSubSelects();
</script>

</body>
</html>
